!function(a,b){function c(a,b,c,d,e,f){this.coordinateDeriver=e||function(a){return{x:a.x,y:a.y}},this.sizeDeriver=f||function(a){return{width:a.width,height:a.height}},this.max_objects=b||10,this.max_levels=c||4,this.level=d||0,this.bounds=a,this.objects=[],this.nodes=[]}c.prototype.split=function(){var a=this.level+1,d=b.round(this.bounds.width/2),e=b.round(this.bounds.height/2),f=b.round(this.bounds.x),g=b.round(this.bounds.y);this.nodes[0]=new c({x:f+d,y:g,width:d,height:e},this.max_objects,this.max_levels,a),this.nodes[1]=new c({x:f,y:g,width:d,height:e},this.max_objects,this.max_levels,a),this.nodes[2]=new c({x:f,y:g+e,width:d,height:e},this.max_objects,this.max_levels,a),this.nodes[3]=new c({x:f+d,y:g+e,width:d,height:e},this.max_objects,this.max_levels,a)},c.prototype.getIndex=function(a){var b=-1,c=this.bounds.x+this.bounds.width/2,d=this.bounds.y+this.bounds.height/2,e=this.coordinateDeriver(a).y<d&&this.coordinateDeriver(a).y+this.sizeDeriver(a).height<d,f=this.coordinateDeriver(a).y>d;return this.coordinateDeriver(a).x<c&&this.coordinateDeriver(a).x+this.sizeDeriver(a).width<c?e?b=1:f&&(b=2):this.coordinateDeriver(a).x>c&&(e?b=0:f&&(b=3)),b},c.prototype.insert=function(a){var b,c=0;if(void 0!==this.nodes[0]&&-1!==(b=this.getIndex(a)))return void this.nodes[b].insert(a);if(this.objects.push(a),this.objects.length>this.max_objects&&this.level<this.max_levels)for(void 0===this.nodes[0]&&this.split();c<this.objects.length;)b=this.getIndex(this.objects[c]),-1!==b?this.nodes[b].insert(this.objects.splice(c,1)[0]):c+=1},c.prototype.retrieve=function(a){var b=this.getIndex(a),c=this.objects;if(void 0!==this.nodes[0])if(-1!==b)c=c.concat(this.nodes[b].retrieve(a));else for(var d=0;d<this.nodes.length;d+=1)c=c.concat(this.nodes[d].retrieve(a));return c},c.prototype.clear=function(){this.objects=[];for(var a=0;a<this.nodes.length;a+=1)void 0!==this.nodes[a]&&this.nodes[a].clear();this.nodes=[]},a.Quadtree=c}(window,Math);